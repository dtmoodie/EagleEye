project(openni2)

file(GLOB_RECURSE src "src/*.h" "src/*.cpp")
LIST(APPEND CMAKE_MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR}/cmake)
find_package(OpenNI2 QUIET)
find_package(OpenCV REQUIRED COMPONENTS cudaarithm)
if(OPENNI2_INCLUDE_DIR)
  include_directories(${OPENNI2_INCLUDE_DIR})
  add_library(aqopenni2 SHARED ${src})

  RCC_LINK_LIB(aqopenni2 aquila_core ${OPENNI2_LIBRARY} RuntimeObjectSystem RuntimeCompiler ${OpenCV_LIBS} ${Aquila_LIBRARIES})
  aquila_declare_plugin(aqopenni2)
  find_path(OPENNI2_BIN_DIR NAMES OpenNI2.dll PATHS ${OPENNI2_LIB_DIR}/../Redist)
  set(OPENNI2_BIN_DIR_DBG ${OPENNI2_BIN_DIR} CACHE PATH "" FORCE)
  set(OPENNI2_BIN_DIR_OPT ${OPENNI2_BIN_DIR} CACHE PATH "" FORCE)
  SET(BIN_DIRS "${BIN_DIRS};OPENNI2" CACHE STRING "" FORCE)
  set_plugin_available(aqopenni2)
  set_plugin_status(aqopenni2 "OpenNI2 found")
else()
    set_plugin_unavailable(aqopenni2)
    set_plugin_status(aqopenni2 "OpenNI2 no found")
endif()
